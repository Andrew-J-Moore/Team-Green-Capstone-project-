<mat-toolbar class="top-detail-row">
    <mat-toolbar-row>
        <h5>{{event.title}}</h5>
        <span class="spacer"></span>
        <mat-form-field class="example-full-width" *ngIf="viewAttendees">
            <input
                type="text"
                class="search-bar"
                matInput
                [(ngModel)]="searchText"
                placeholder="Search guests"
            />
            <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
        <span class="spacer"></span><mat-icon (click)="close()" class="close-button" matTooltip="Close">clear</mat-icon>
    </mat-toolbar-row>
</mat-toolbar>

<div mat-dialog-content class="content">
    <div class="event-wrap" *ngIf="!viewAttendees">
        <small *ngIf="event.allDay">* All Day</small>
        <div *ngIf="!event.allDay">
            <p>{{ event.start.toLocaleString([], {month:'2-digit', day:'2-digit', year:'2-digit', hour: '2-digit',  minute:'2-digit'}) }} - 
            {{event.end.toLocaleString([], {month:'2-digit', day:'2-digit', year:'2-digit', hour: '2-digit',  minute:'2-digit'}) }}</p>
        </div>
        <div *ngIf="event.allDay && event.start !== newEnd && event.end !== null">
            <p>{{event.start.toLocaleDateString()}} - {{newEnd.toLocaleDateString()}}</p>
        </div>
        <div *ngIf="!event.end">
            <p>{{event.start.toLocaleDateString()}}</p>
        </div>
        <p *ngIf="event.extendedProps.location != ''"><b>Location:</b> {{ event.extendedProps.location }}</p>
        <p *ngIf="event.extendedProps.description != ''"><b>Description:</b> {{ event.extendedProps.description }}</p>
    </div>
    <div *ngIf="viewAttendees">
        <p *ngIf="event.extendedProps.recipients.length === 0">This event has no recipients.</p>
        <div class="user-wrap" *ngIf="viewAll">
            <mat-selection-list
            #users
            (selectionChange)="onSelectChange(users.selectedOptions.selected)">
                <mat-list-option *ngFor="let user of guests | filterMember: searchText" [value]="user.email">
                    <mat-icon mat-list-icon>person_outline</mat-icon>
                    <h4 mat-line>{{user.name}}</h4>
                    <p mat-line>{{user.email}}</p>
                </mat-list-option>
            </mat-selection-list>
        </div>
        <div class="user-wrap" *ngIf="viewConfirmed">
            <mat-selection-list
            #confirmed
            (selectionChange)="onSelectChange(confirmed.selectedOptions.selected)"
            >
                <mat-list-option *ngFor="let user of event.extendedProps.recipients | filterMember: searchText" [value]="user.email">
                    <mat-icon mat-list-icon>person_outline</mat-icon>
                    <h4 mat-line>{{user.name}}</h4>
                    <p mat-line>{{user.email}}</p>
                </mat-list-option>
            </mat-selection-list>
        </div> 
        <div class="user-wrap" *ngIf="viewPending">
            <mat-selection-list
            #confirmed
            (selectionChange)="onSelectChange(confirmed.selectedOptions.selected)"
            >
                <mat-list-option *ngFor="let user of pending | filterMember: searchText" [value]="user.email">
                    <mat-icon mat-list-icon>person_outline</mat-icon>
                    <h4 mat-line>{{user.name}}</h4>
                    <p mat-line>{{user.email}}</p>
                </mat-list-option>
            </mat-selection-list>
        </div> 
    </div>
    
</div>

<mat-toolbar class="bottom-row">
    <mat-toolbar-row>
        <button mat-raised-button [matMenuTriggerFor]="menu" class="button-maroon"
        *ngIf="!isAppt && (event.extendedProps.createdBy.email===username || invitees.includes(username))">Options</button> 
        <mat-menu #menu class="options-button primary">
            <button mat-menu-item (click)="editEvent()" *ngIf="event.extendedProps.createdBy.email === username" class="option">Edit Event</button>
            <button mat-menu-item (click)="deleteEvent()" *ngIf="event.extendedProps.createdBy.email === username" class="option">Delete</button>
            <button mat-menu-item (click)="shareEvent()" *ngIf="event.extendedProps.createdBy.email===username" class="option">Share</button>
            <button mat-menu-item *ngIf="event.extendedProps.createdBy.email !== username" class="option" (click)="confirmAttendance()">Confirm Attendance</button>
            <button mat-menu-item *ngIf="event.extendedProps.createdBy.email === username && !viewAttendees" class="option" (click)="viewGuests()">View Attendees</button>
            <button mat-menu-item *ngIf="event.extendedProps.createdBy.email === username && viewAttendees" class="option" (click)="viewGuests()">View Details</button>
        </mat-menu>&nbsp;
        <mat-chip-list *ngIf="event.extendedProps.createdBy.email === username && (viewAttendees)">
            <mat-chip (click)="switchToPending()">Pending</mat-chip>
            <mat-chip (click)="switchToConfirmed()">All</mat-chip>
            <mat-chip (click)="switchToAll()">Going</mat-chip>
        </mat-chip-list>&nbsp;
        <button
            mat-raised-button
            class="button-maroon"
            (click)="messageSelectedRecipients()"
            matTooltip="click to message selected recipients"
            *ngIf="viewAttendees && selectedRecipients.length>0"
          >
            <mat-icon mat-list-icon>email</mat-icon> &nbsp; Email Selected
          </button>
        <mat-hint *ngIf="isAppt">Please see the appointments section to make changes.</mat-hint>
    </mat-toolbar-row>
</mat-toolbar>
